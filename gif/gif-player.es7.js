!function(){"use strict";function e(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw"Invalid GIF 87a/89a header.";var s=e[t++]|e[t++]<<8,i=e[t++]|e[t++]<<8,n=e[t++],a=n>>7,r=1<<(7&n)+1;e[t++];e[t++];var h=null;a&&(h=t,t+=3*r);var o=!0,d=[],l=0,c=null,m=0,u=null;for(this.width=s,this.height=i;o&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,u=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(0===(B=e[t++]))break;t+=B}break;case 249:if(4!==e[t++]||0!==e[t+4])throw"Invalid graphics extension block.";var p=e[t++];l=e[t++]|e[t++]<<8,c=e[t++],0==(1&p)&&(c=null),m=p>>2&7,t++;break;case 254:for(;;){if(0===(B=e[t++]))break;t+=B}break;default:throw"Unknown graphic control label: 0x"+e[t-1].toString(16)}break;case 44:var _=e[t++]|e[t++]<<8,f=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,y=e[t++],b=y>>6&1,w=h,k=!1;if(y>>7){k=!0;w=t,t+=3*(1<<(7&y)+1)}var x=t;for(t++;;){var B;if(0===(B=e[t++]))break;t+=B}d.push({x:_,y:f,width:v,height:g,has_local_palette:k,palette_offset:w,data_offset:x,data_length:t-x,transparent_index:c,interlaced:!!b,delay:l,disposal:m});break;case 59:o=!1;break;default:throw"Unknown gif block: 0x"+e[t-1].toString(16)}this.numFrames=function(){return d.length},this.loopCount=function(){return u},this.frameInfo=function(e){if(e<0||e>=d.length)throw"Frame index out of range.";return d[e]},this.decodeAndBlitFrameRGBA=function(t,i){var n=this.frameInfo(t),a=n.width*n.height,r=new Uint8Array(a);!function(e,t,s,i){var n=e[t++],a=1<<n,r=a+1,h=r+1,o=n+1,d=(1<<o)-1,l=0,c=0,m=0,u=e[t++],p=new Int32Array(4096),_=null;for(;;){for(;l<16&&0!==u;)c|=e[t++]<<l,l+=8,1===u?u=e[t++]:--u;if(l<o)break;var f=c&d;if(c>>=o,l-=o,f!==a){if(f===r)break;for(var v=f<h?f:_,g=0,y=v;y>a;)y=p[y]>>8,++g;var b=y,w=m+g+(v!==f?1:0);if(w>i)return void console.log("Warning, gif stream longer than expected.");s[m++]=b;var k=m+=g;for(v!==f&&(s[m++]=b),y=v;g--;)y=p[y],s[--k]=255&y,y>>=8;null!==_&&h<4096&&(p[h++]=_<<8|b,h>=d+1&&o<12&&(++o,d=d<<1|1)),_=f}else h=r+1,d=(1<<(o=n+1))-1,_=null}m!==i&&console.log("Warning, gif stream shorter than expected.")}(e,n.data_offset,r,a);var h=n.palette_offset,o=n.transparent_index;null===o&&(o=256);var d=n.width,l=s-d,c=d,m=4*(n.y*s+n.x),u=4*((n.y+n.height)*s+n.x),p=m,_=4*l;!0===n.interlaced&&(_+=4*s*7);for(var f=8,v=0,g=r.length;v<g;++v){var y=r[v];if(0===c&&(c=d,(p+=_)>=u&&(_=4*l+4*s*(f-1),p=m+(d+l)*(f<<1),f>>=1)),y===o)p+=4;else{var b=e[h+3*y],w=e[h+3*y+1],k=e[h+3*y+2];i[p++]=b,i[p++]=w,i[p++]=k,i[p++]=255}--c}}}var t=function(){const t=document.createElement("template");t.innerHTML="\n<style>\n  canvas {\n    position: absolute;\n  }\n\n  @keyframes spinner {\n    to {transform: rotate(360deg);}\n  }\n\n  .spinner:before {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 20px;\n    height: 20px;\n    margin-top: -10px;\n    margin-left: -10px;\n    border-radius: 50%;\n    border-top: 2px solid #999;\n    border-right: 2px solid transparent;\n    animation: spinner .6s linear infinite;\n  }\n</style>\n<canvas></canvas>\n<div class=\"spinner\"></spinner>\n";window.customElements.define("gif-player",class extends HTMLElement{static get observedAttributes(){return["src","frame","size","speed","play","swipe","repeat","bounce","direction"]}constructor(){super(),this._speed=.5,this._size="auto",this._swipe=!0,this._repeat=!0,this._bounce=!1,this._prerender=!1,this._direction=1,this._reset(),this.pausePlaybackBound=this.pausePlayback.bind(this),this.moveBound=this.move.bind(this),this.resumePlaybackBound=this.resumePlayback.bind(this),this.prerenderFramesBound=this.prerenderFrames.bind(this),this.playLoopBound=this.playLoop.bind(this);const e=this.attachShadow({mode:"open"});e.appendChild(document.importNode(t.content,!0)),this._spinner=e.querySelector(".spinner"),this._canvas=e.querySelector("canvas"),this._ctx=this._canvas.getContext("2d")}connectedCallback(){this.style.display="inline-block",this.style.position="relative",this.style.overflow="hidden",this.style.cursor="col-resize",this.addEventListener("touchstart",this.pausePlaybackBound,!1),this.addEventListener("touchmove",this.moveBound,!1),this.addEventListener("touchend",this.resumePlaybackBound,!1),this.addEventListener("mouseenter",this.pausePlaybackBound,!1),this.addEventListener("mousemove",this.moveBound,!1),this.addEventListener("mouseleave",this.resumePlaybackBound,!1)}disconnectedCallback(){this.removeEventListener("touchstart",this.pausePlaybackBound,!1),this.removeEventListener("touchmove",this.moveBound,!1),this.removeEventListener("touchend",this.resumePlaybackBound,!1),this.removeEventListener("mouseenter",this.pausePlaybackBound,!1),this.removeEventListener("mousemove",this.moveBound,!1),this.removeEventListener("mouseleave",this.resumePlaybackBound,!1)}attributeChangedCallback(e,t,s){t!==s&&(this[e]=s)}_reset(){this._frames=[],this._delays=[],this._frame=0,this._decoded=-1,this._rendered=-1}_handleBoolean(e,t){this["_"+e]=t=null!==t&&void 0!==t,t?this.setAttribute(e,""):this.removeAttribute(e)}get src(){return this._src}set src(e){this._src=e,this.load(e)}get frame(){return this._frame}set frame(e){this._frame=parseInt(e),this.displayFrame(this._frames,this._frame)}get size(){return this._size}set size(e){this._size=e}get speed(){return this._speed}set speed(e){this._speed=parseFloat(e)}get swipe(){return this._swipe}set swipe(e){this._swipe=e}get play(){return this._play}set play(e){this._handleBoolean("play",e)}get repeat(){return this._repeat}set repeat(e){this._repeat=parseFloat(e)}get bounce(){return this._bounce}set bounce(e){this._handleBoolean("bounce",e)}get direction(){return this._direction}set direction(e){this._direction=parseInt(e)}get prerender(){return this._prerender}set prerender(e){this._prerender=e}get onload(){return this._onload}set onload(e){this._onload=e}move(e){var t;e.preventDefault(),t=e.targetTouches?e.targetTouches[0].clientX:e.clientX;var s=this.getBoundingClientRect(),i=(t-s.left)/s.width;this.frame=Math.round((this._frames.length-1)*i)}load(t){this._reset(),this.dispatchEvent(new CustomEvent("gif-loading",{bubbles:!0,composed:!0,detail:t})),this._spinner.style.display="block",fetch(t,{method:"GET",mode:"cors",cache:"default"}).then(e=>e.arrayBuffer()).then(e=>new Uint8Array(e)).then(t=>new e(t)).then(e=>this.process(e)).then(()=>this._spinner.style.display="none")}process(e){this._gif=e,this._canvas.width=e.width,this._canvas.height=e.height;var t=e.width/e.height,s=this.clientWidth/this.clientHeight;switch(this._canvas.style.top=0,this._canvas.style.left=0,this._size){case"auto":this.style.width=e.width+"px",this.style.height=e.height+"px";break;case"cover":t>s?(i=this.clientHeight*t,n=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=-(i-this.clientWidth)/2+"px"):(i=this.clientWidth,n=this.clientWidth/t,this._canvas.style.top=-(n-this.clientHeight)/2+"px",this._canvas.style.left=0),this._canvas.style.width=i+"px",this._canvas.style.height=n+"px";break;case"contain":var i,n;t>s?(i=this.clientWidth,n=this.clientWidth/t,this._canvas.style.top=(this.clientHeight-n)/2+"px",this._canvas.style.left=0):(i=this.clientHeight*t,n=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=(this.clientWidth-i)/2+"px"),this._canvas.style.width=i+"px",this._canvas.style.height=n+"px";break;case"stretch":this._canvas.style.width="100%",this._canvas.style.height="100%"}var a=e.numFrames();this._decoded=-1,this._delays=new Array(a),this._frames=new Array(a),this._frame<0&&(this._frame=this._frames.length+this._frame);var r=new CustomEvent("gif-loaded",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(r),this._onload&&this._onload(r),this._play?this.start():this.displayFrame(this._frames,this._frame),this._prerender&&requestIdleCallback(this.prerenderFramesBound)}start(){this.playing=!0,this.playAnimation(this._frames,this._frame)}stop(){this.playing=!1}pausePlayback(e){this.paused=!0}resumePlayback(e){this.paused=!1,this.playing&&this.playAnimation(this._frames,this._frame)}playLoop(e){this.rafHandle=requestAnimationFrame(this.playLoopBound),this._rendered!=this._frame&&this._frames[this._frame]&&(this._rendered=this._frame,this._ctx.putImageData(this._frames[this._frame],0,0))}playAnimation(e,t){0!==e.length&&(this.renderFrame(t),setTimeout(()=>{if(!this.paused){var e=this.frame+this._direction;e<0?this._bounce?(this._direction=1,e=1):e=this._frames.length-1:e>=this._frames.length&&(this._bounce?(this._direction=-1,e=this._frames.length-2):e=0),this.frame=e,this.playAnimation(this._frames,this._frame)}},this._delays[t]*(1/this._speed)))}next(){this.frame++,this.frame>=this._frames.length&&(this.frame=0),this.render(this.frame)}displayFrame(e,t){0!==e.length&&(t>=e.length&&(t=e.length-1),t<0&&(t+=e.length),this.renderFrame(t),this._rendered!=t&&requestAnimationFrame(()=>{this._ctx.putImageData(this._frames[t],0,0),this._rendered=t,this.dispatchEvent(new CustomEvent("gif-frame",{bubbles:!0,composed:!0,detail:t}))}))}renderFrame(e){for(;this._decoded<e;){var t=this._decoded+1,s=this._gif.frameInfo(t),i=this._ctx.createImageData(this._gif.width,this._gif.height);t>0&&s.disposal<2&&i.data.set(new Uint8ClampedArray(this._frames[t-1].data)),this._gif.decodeAndBlitFrameRGBA(t,i.data),this._frames[t]=i,this._delays[t]=10*s.delay,this._decoded=t}}prerenderFrames(e){for(;e.timeRemaining()>0&&this._decoded<this._frames.length-1;)this.renderFrame(this._decoded+1);this._decoded<this._frames.length-1&&requestIdleCallback(this.prerenderBound)}})};window.requestIdleCallback=window.requestIdleCallback||function(e){var t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)},window.WebComponents&&window.WebComponents.ready?t():window.addEventListener("WebComponentsReady",t)}();
//# sourceMappingURL=gif-player.es7.js.map
