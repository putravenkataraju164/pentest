!function(){"use strict";function s(k){var e=0;if(71!==k[e++]||73!==k[e++]||70!==k[e++]||56!==k[e++]||56!=(k[e++]+1&253)||97!==k[e++])throw"Invalid GIF 87a/89a header.";var w=k[e++]|k[e++]<<8,t=k[e++]|k[e++]<<8,n=k[e++],i=n>>7,s=1<<1+(7&n);k[e++];k[e++];var a=null;i&&(a=e,e+=3*s);var r=!0,o=[],h=0,l=null,c=0,d=null;for(this.width=w,this.height=t;r&&e<k.length;)switch(k[e++]){case 33:switch(k[e++]){case 255:if(11!==k[e]||78==k[e+1]&&69==k[e+2]&&84==k[e+3]&&83==k[e+4]&&67==k[e+5]&&65==k[e+6]&&80==k[e+7]&&69==k[e+8]&&50==k[e+9]&&46==k[e+10]&&48==k[e+11]&&3==k[e+12]&&1==k[e+13]&&0==k[e+16])e+=14,d=k[e++]|k[e++]<<8,e++;else for(e+=12;;){if(0===(B=k[e++]))break;e+=B}break;case 249:if(4!==k[e++]||0!==k[e+4])throw"Invalid graphics extension block.";var u=k[e++];h=k[e++]|k[e++]<<8,l=k[e++],0==(1&u)&&(l=null),c=u>>2&7,e++;break;case 254:for(;;){if(0===(B=k[e++]))break;e+=B}break;default:throw"Unknown graphic control label: 0x"+k[e-1].toString(16)}break;case 44:var f=k[e++]|k[e++]<<8,p=k[e++]|k[e++]<<8,m=k[e++]|k[e++]<<8,_=k[e++]|k[e++]<<8,v=k[e++],y=v>>6&1,g=a,b=!1;if(v>>7){b=!0;g=e,e+=3*(1<<1+(7&v))}var x=e;for(e++;;){var B;if(0===(B=k[e++]))break;e+=B}o.push({x:f,y:p,width:m,height:_,has_local_palette:b,palette_offset:g,data_offset:x,data_length:e-x,transparent_index:l,interlaced:!!y,delay:h,disposal:c});break;case 59:r=!1;break;default:throw"Unknown gif block: 0x"+k[e-1].toString(16)}this.numFrames=function(){return o.length},this.loopCount=function(){return d},this.frameInfo=function(e){if(e<0||e>=o.length)throw"Frame index out of range.";return o[e]},this.decodeAndBlitFrameRGBA=function(e,t){var n=this.frameInfo(e),i=n.width*n.height,s=new Uint8Array(i);!function(e,t,n,i){var s=e[t++],a=1<<s,r=1+a,o=1+r,h=s+1,l=(1<<h)-1,c=0,d=0,u=0,f=e[t++],p=new Int32Array(4096),m=null;for(;;){for(;c<16&&0!==f;)d|=e[t++]<<c,c+=8,1===f?f=e[t++]:--f;if(c<h)break;var _=d&l;if(d>>=h,c-=h,_!=a){if(_==r)break;for(var v=_<o?_:m,y=0,g=v;a<g;)g=p[g]>>8,++y;var b=g;if(i<u+y+(v!==_?1:0))return console.log("Warning, gif stream longer than expected.");n[u++]=b;var k=u+=y;for(v!==_&&(n[u++]=b),g=v;y--;)g=p[g],n[--k]=255&g,g>>=8;null!==m&&o<4096&&(p[o++]=m<<8|b,l+1<=o&&h<12&&(++h,l=l<<1|1)),m=_}else o=1+r,l=(1<<(h=s+1))-1,m=null}u!==i&&console.log("Warning, gif stream shorter than expected.")}(k,n.data_offset,s,i);var a=n.palette_offset,r=n.transparent_index;null===r&&(r=256);var o=n.width,h=w-o,l=o,c=4*(n.y*w+n.x),d=4*((n.y+n.height)*w+n.x),u=c,f=4*h;!0===n.interlaced&&(f+=4*w*7);for(var p=8,m=0,_=s.length;m<_;++m){var v=s[m];if(0===l&&(l=o,d<=(u+=f)&&(f=4*h+4*w*(p-1),u=c+(o+h)*(p<<1),p>>=1)),v===r)u+=4;else{var y=k[a+3*v],g=k[a+3*v+1],b=k[a+3*v+2];t[u++]=y,t[u++]=g,t[u++]=b,t[u++]=255}--l}}}var t=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e(){var n=document.createElement("template");n.innerHTML="\n<style>\n  canvas {\n    position: absolute;\n  }\n\n  @keyframes spinner {\n    to {transform: rotate(360deg);}\n  }\n\n  .spinner:before {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 20px;\n    height: 20px;\n    margin-top: -10px;\n    margin-left: -10px;\n    border-radius: 50%;\n    border-top: 2px solid #999;\n    border-right: 2px solid transparent;\n    animation: spinner .6s linear infinite;\n  }\n</style>\n<canvas></canvas>\n<div class=\"spinner\"></spinner>\n";var e=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,HTMLElement),t(i,null,[{key:"observedAttributes",get:function(){return["src","frame","size","speed","play","swipe","repeat","bounce","direction"]}}]),t(i,[{key:"connectedCallback",value:function(){this.style.display="inline-block",this.style.position="relative",this.style.overflow="hidden",this.style.cursor="col-resize",this.addEventListener("touchstart",this.pausePlaybackBound,!1),this.addEventListener("touchmove",this.moveBound,!1),this.addEventListener("touchend",this.resumePlaybackBound,!1),this.addEventListener("mouseenter",this.pausePlaybackBound,!1),this.addEventListener("mousemove",this.moveBound,!1),this.addEventListener("mouseleave",this.resumePlaybackBound,!1)}},{key:"disconnectedCallback",value:function(){this.removeEventListener("touchstart",this.pausePlaybackBound,!1),this.removeEventListener("touchmove",this.moveBound,!1),this.removeEventListener("touchend",this.resumePlaybackBound,!1),this.removeEventListener("mouseenter",this.pausePlaybackBound,!1),this.removeEventListener("mousemove",this.moveBound,!1),this.removeEventListener("mouseleave",this.resumePlaybackBound,!1)}},{key:"attributeChangedCallback",value:function(e,t,n){t!==n&&(this[e]=n)}},{key:"_reset",value:function(){this._frames=[],this._delays=[],this._frame=0,this._decoded=-1,this._rendered=-1}},{key:"_handleBoolean",value:function(e,t){this["_"+e]=t=null!=t,t?this.setAttribute(e,""):this.removeAttribute(e)}},{key:"move",value:function(e){var t;e.preventDefault(),t=e.targetTouches?e.targetTouches[0].clientX:e.clientX;var n=this.getBoundingClientRect(),i=(t-n.left)/n.width;this.frame=Math.round((this._frames.length-1)*i)}},{key:"load",value:function(e){var t=this;this._reset(),this.dispatchEvent(new CustomEvent("gif-loading",{bubbles:!0,composed:!0,detail:e})),this._spinner.style.display="block",fetch(e,{method:"GET",mode:"cors",cache:"default"}).then(function(e){return e.arrayBuffer()}).then(function(e){return new Uint8Array(e)}).then(function(e){return new s(e)}).then(function(e){return t.process(e)}).then(function(){return t._spinner.style.display="none"})}},{key:"process",value:function(e){this._gif=e,this._canvas.width=e.width,this._canvas.height=e.height;var t=e.width/e.height,n=this.clientWidth/this.clientHeight;switch(this._canvas.style.top=0,this._canvas.style.left=0,this._size){case"auto":this.style.width="610px",this.style.height=Math.floor(((e.height/e.width)*610)+1)+"px";this._canvas.style.width="610px",this._canvas.style.height=Math.floor(((e.height/e.width)*610)+1)+"px";break;case"cover":n<t?(i=this.clientHeight*t,s=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=-(i-this.clientWidth)/2+"px"):(i=this.clientWidth,s=this.clientWidth/t,this._canvas.style.top=-(s-this.clientHeight)/2+"px",this._canvas.style.left=0),this._canvas.style.width=i+"px",this._canvas.style.height=s+"px";break;case"contain":var i,s;n<t?(i=this.clientWidth,s=this.clientWidth/t,this._canvas.style.top=(this.clientHeight-s)/2+"px",this._canvas.style.left=0):(i=this.clientHeight*t,s=this.clientHeight,this._canvas.style.top=0,this._canvas.style.left=(this.clientWidth-i)/2+"px"),this._canvas.style.width=i+"px",this._canvas.style.height=s+"px";break;case"stretch":this._canvas.style.width="100%",this._canvas.style.height="100%"}var a=e.numFrames();this._decoded=-1,this._delays=new Array(a),this._frames=new Array(a),this._frame<0&&(this._frame=this._frames.length+this._frame);var r=new CustomEvent("gif-loaded",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(r),this._onload&&this._onload(r),this._play?this.start():this.displayFrame(this._frames,this._frame),this._prerender&&requestIdleCallback(this.prerenderFramesBound)}},{key:"start",value:function(){this.playing=!0,this.playAnimation(this._frames,this._frame)}},{key:"stop",value:function(){this.playing=!1}},{key:"pausePlayback",value:function(e){this.paused=!0}},{key:"resumePlayback",value:function(e){this.paused=!1,this.playing&&this.playAnimation(this._frames,this._frame)}},{key:"playLoop",value:function(e){this.rafHandle=requestAnimationFrame(this.playLoopBound),this._rendered!=this._frame&&this._frames[this._frame]&&(this._rendered=this._frame,this._ctx.putImageData(this._frames[this._frame],0,0))}},{key:"playAnimation",value:function(e,t){var n=this;0!==e.length&&(this.renderFrame(t),setTimeout(function(){if(!n.paused){var e=n.frame+n._direction;e<0?e=n._bounce?n._direction=1:n._frames.length-1:e>=n._frames.length&&(e=n._bounce?(n._direction=-1,n._frames.length-2):0),n.frame=e,n.playAnimation(n._frames,n._frame)}},this._delays[t]*(1/this._speed)))}},{key:"next",value:function(){this.frame++,this.frame>=this._frames.length&&(this.frame=0),this.render(this.frame)}},{key:"displayFrame",value:function(e,t){var n=this;0!==e.length&&(t>=e.length&&(t=e.length-1),t<0&&(t+=e.length),this.renderFrame(t),this._rendered!=t&&requestAnimationFrame(function(){n._ctx.putImageData(n._frames[t],0,0),n._rendered=t,n.dispatchEvent(new CustomEvent("gif-frame",{bubbles:!0,composed:!0,detail:t}))}))}},{key:"renderFrame",value:function(e){for(;this._decoded<e;){var t=this._decoded+1,n=this._gif.frameInfo(t),i=this._ctx.createImageData(this._gif.width,this._gif.height);0<t&&n.disposal<2&&i.data.set(new Uint8ClampedArray(this._frames[t-1].data)),this._gif.decodeAndBlitFrameRGBA(t,i.data),this._frames[t]=i,this._delays[t]=10*n.delay,this._decoded=t}}},{key:"prerenderFrames",value:function(e){for(;0<e.timeRemaining()&&this._decoded<this._frames.length-1;)this.renderFrame(this._decoded+1);this._decoded<this._frames.length-1&&requestIdleCallback(this.prerenderBound)}},{key:"src",get:function(){return this._src},set:function(e){this._src=e,this.load(e)}},{key:"frame",get:function(){return this._frame},set:function(e){this._frame=parseInt(e),this.displayFrame(this._frames,this._frame)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=parseFloat(e)}},{key:"swipe",get:function(){return this._swipe},set:function(e){this._swipe=e}},{key:"play",get:function(){return this._play},set:function(e){this._handleBoolean("play",e)}},{key:"repeat",get:function(){return this._repeat},set:function(e){this._repeat=parseFloat(e)}},{key:"bounce",get:function(){return this._bounce},set:function(e){this._handleBoolean("bounce",e)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=parseInt(e)}},{key:"prerender",get:function(){return this._prerender},set:function(e){this._prerender=e}},{key:"onload",get:function(){return this._onload},set:function(e){this._onload=e}}]),i);function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));e._speed=.5,e._size="auto",e._swipe=!0,e._repeat=!0,e._bounce=!1,e._prerender=!1,e._direction=1,e._reset(),e.pausePlaybackBound=e.pausePlayback.bind(e),e.moveBound=e.move.bind(e),e.resumePlaybackBound=e.resumePlayback.bind(e),e.prerenderFramesBound=e.prerenderFrames.bind(e),e.playLoopBound=e.playLoop.bind(e);var t=e.attachShadow({mode:"open"});return t.appendChild(document.importNode(n.content,!0)),e._spinner=t.querySelector(".spinner"),e._canvas=t.querySelector("canvas"),e._ctx=e._canvas.getContext("2d"),e}window.customElements.define("gif-player",e)}window.requestIdleCallback=window.requestIdleCallback||function(e){var t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)},window.WebComponents&&window.WebComponents.ready?e():window.addEventListener("WebComponentsReady",e)}();
//# sourceMappingURL=gif-player.es5.js.map
