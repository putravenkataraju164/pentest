<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="../pkg/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
	mark {
	  background-color: #52BE80;
	}
  </style>
  <script src="../gif/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../gif/gif-player.es5.js" defer async></script>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="re101"
                  title="Malware Analysis"
                  environment="web"
                  feedback-link="">


      <google-codelab-step label="Intro" duration="5">
			<h2 is-upgraded>Malware Analysis</h2>
      <p>Malware analysis is the art of dissecting malware to understand how its works, how to identify it, and how to defeat or eliminate it. And you don’t need to be an uber-hacker to perform malware analysis.</p>
      <h2 is-upgraded>Prerequisites</h2>
			<ul>
			<li>Information Security Basics</li>
			<li>Basic Knowledge in Security</li>
			<li>Familiar with Windows and Linux OS</li>
			<li>Programming knowledge in Assembly language and C language</li>
			</ul>
			<h2 is-upgraded>What you&#39;ll learn</h2>
			<ul class="checklist">
			<li>Different Malware Analysis Techniques</li>
			<li>How to use Anti-disassembly and Anti-debugging or packing techniques</li>
			<li>Practical Malware Analysis and Reverse Engineering</li>
			<li>Working with various MA and RE Tools</li>
			</ul>
      </google-codelab-step>
      <google-codelab-step label="Malware Analysis Premier" duration="30">
			<ul>
      <li>The purpose  of <code>malware analysis</code> is usually to provide the information you need to respond to a network intrusion.</li>
      <li>Your goals will typically be to determine exactly what happened, and to ensure that you’ve located all infected machines and files.</li>
      <li>When analyzing suspected malware, your goal will typically be to determine exactly what a particular suspect binary can do, how to detect it on your network, and how to measure and contain its damage.</li>
      <li>Once you identify which files require full analysis, it’s time to develop signatures to detect malware infections on your network</li>
      </ul>
      <h2 is-upgraded>Signatures / Indicators</h2>
      <p>Malware analysis can be used to develop <code>host-based</code> and <code>network signatures</code>.</p>
      <ul>
      <li><b>Host-based signatures</b> are used to detect malicious code on victim computers. These indicators often identify files created or modified by the malware or specific changes that it makes to the registry.</li>
      <aside class="special">Unlike antivirus signatures, malware indicators focus on what the malware does to a system, not on the characteristics of the malware itself, which makes them more effective in detecting malware that changes form or that has been deleted from the hard disk.</aside>
      <li><b>Network signatures</b> are used to detect malicious code by monitoring network traffic. Network signatures can be created without malware analysis, but signatures created with the help of malware analysis are usually far more effective, offering a higher detection rate and fewer false positives</li>
      </ul>
      <h2 is-upgraded>Malware Analysis Techniques</h2>
      <p>There are two fundamental approaches to malware analysis: <code>static</code> and <code>dynamic</code>. Both static and dynamic are further categorized as <code>basic</code> or <code>advanced</code>.</p>
      <ol>
        <pre><code>Static analysis involves examining the malware without running it.<br>Dynamic analysis involves running the malware.</code></pre>
        <li><b>Basic static analysis</b> consists of examining the executable file without viewing the actual instructions. Basic static analysis can confirm whether a file is malicious, provide information about its functionality, and sometimes provide information that will allow you to produce simple network signatures. </li>
        <li><b>Basic dynamic analysis</b> techniques involve running the malware and observing its behavior on the system in order to remove the infection, produce effective signatures, or both.</li>
          <aside class="special">Basic dynamic analysis techniques can be used by most people without deep programming knowledge, but they won’t be effective with all malware and can miss important functionality.</aside>
        <li><b>Advanced static analysis</b> consists of reverse-engineering the malware’s internals by loading the executable into a disassembler and looking at the program instructions in order to discover what the program does. The instructions are executed by the CPU.</li>
        <li><b>Advanced dynamic analysis</b> uses a debugger to examine the internal state of a running malicious executable. It provide another way to extract detailed information from an executable.</li>
          <aside class="special">Advance techniques are most useful when you’re trying to obtain information that is difficult to gather with the other techniques.</aside>
      </ol>
      <pre><code>Before you can run malware safely, you must set up an environment that will allow you to study the running malware without risk of damage to your system or network.</code></pre>
      </google-codelab-step>
      <google-codelab-step label="Types of Malware" duration="15">
        <table>
      <tr><td colspan="1" rowspan="1"><p><strong>Type</strong></p>
      </td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Virus</strong></p>
      </td><td colspan="1" rowspan="1"><p>Code that propagates (replicates) across systems with user intervention</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Worm</strong></p>
      </td><td colspan="1" rowspan="1"><p>Code that self-propagates/replicates across systems without requiring user intervention</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Bot</strong></p>
      </td><td colspan="1" rowspan="1"><p>Automated process that interacts with other network services</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Trojan</strong></p>
      </td><td colspan="1" rowspan="1"><p>Malware that is often disguised as legitimate software</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Ransomware</strong></p>
      </td><td colspan="1" rowspan="1"><p>Malware that holds the victim&#39;s data hostage by cryptography or other means</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Rootkit</strong></p>
      </td><td colspan="1" rowspan="1"><p>Masks its existence or the existence of other software</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Backdoor</strong></p>
      </td><td colspan="1" rowspan="1"><p>Enables a remote attacker to have access to or send commands to a compromised computer</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>RAT</strong></p>
      </td><td colspan="1" rowspan="1"><p>Remote Access Trojan, similar to a backdoor</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Info Stealer</strong></p>
      </td><td colspan="1" rowspan="1"><p>Steals victims information, passwords, or other personal data</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>HackTool</strong></p>
      </td><td colspan="1" rowspan="1"><p>Admin tools or programs that may be used by hackers to attack computer systems and networks. These programs are not generally malicious</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Hoax</strong></p>
      </td><td colspan="1" rowspan="1"><p>Program may deliver a false warning about a computer virus or install a fake AV</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Dropper/Downloader</strong></p>
      </td><td colspan="1" rowspan="1"><p>Designed to &#34;install&#34; or download some sort of malware</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>Adware</strong></p>
      </td><td colspan="1" rowspan="1"><p>Automatically renders advertisements in order to generate revenue for its author.</p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>PUP/PUA</strong></p>
      </td><td colspan="1" rowspan="1"><p>Potentially Unwanted Program, sometimes added to a system without the user&#39;s knowledge or approval</p>
      </td></tr>
      </table>
     <aside class="special">Malware often spans multiple categories. For example, a program might have a keylogger that collects passwords and a worm component that sends spam.</aside>
     </google-codelab-step>
     <google-codelab-step label="Portable Executable (PE)" duration="15">
      <p>Portable Executable (PE) file format is used by Windows executables, object code, and DLLs. The PE file format is a data structure that contains the information necessary for the Windows OS loader to manage the wrapped executable code.</p>
      <ul>
        <li> Nearly every file with executable code that is loaded by Windows is in the PE file format, though some legacy file formats do appear on rare occasion in malware. </li>
        <li>PE files begin with a header that includes information about the code, the type of application, required library functions, and space requirements. The information in the PE header is of great value to the malware analyst.</li>
      </ul>
      <h2 is-upgraded>PE File Headers and Sections</h2>
      <p>The PE file format contains a header followed by a series of sections. The header contains metadata about the file itself. Following the header are the actual sections of the file, each of which contains useful information.</p>
      <table>
      <tr><td colspan="1" rowspan="1"><p><strong>Section</strong></p>
      </td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
      </td></tr>
      <tr><td colspan="1" rowspan="1"><p><strong>.text</strong></p>
      </td><td colspan="1" rowspan="1"><p>Contains the executable code, instructions to the CPU</p>
      <tr><td colspan="1" rowspan="1"><p><strong>.rdata</strong></p>
      </td><td colspan="1" rowspan="1"><p>Holds read-only data that is globally accessible within the program, import and export information </p>
      <tr><td colspan="1" rowspan="1"><p><strong>.data</strong></p>
      </td><td colspan="1" rowspan="1"><p>Stores global data accessed throughout the program, which is accessible from anywhere in the program. </p>
      <tr><td colspan="1" rowspan="1"><p><strong>.idata</strong></p>
      </td><td colspan="1" rowspan="1"><p>Sometimes present and stores the import function information; if this section is not present, the import function information is stored in the .rdata section</p>
      <tr><td colspan="1" rowspan="1"><p><strong>.edata</strong></p>
      </td><td colspan="1" rowspan="1"><p>Sometimes present and stores the export function information; if this section is not present, the export function information is stored in the .rdata section</p>
      <tr><td colspan="1" rowspan="1"><p><strong>.pdata</strong></p>
      </td><td colspan="1" rowspan="1"><p>Present only in 64-bit executables and stores exception-handling information</p>
      <tr><td colspan="1" rowspan="1"><p><strong>.rsrc</strong></p>
      </td><td colspan="1" rowspan="1"><p>Stores resources needed by the executable</p>
      <tr><td colspan="1" rowspan="1"><p><strong>.reloc</strong></p>
      </td><td colspan="1" rowspan="1"><p>Contains information for relocation of library files</p>
      </td></tr>
      </table>
      <h2 is-upgraded>Functions</h2>
      <ul>
        <li>Imports are functions used by one program that are actually stored in a different program, such as code libraries that contain functionality common to many programs. Code libraries can be connected to the main executable by <code>linking</code>.</li>
        <aside class="special">Programmers link imports to their programs so that they don’t need to re-implement certain functionality in multiple programs. Code libraries can be linked statically, at runtime, or dynamically</aside>
        <li>Exports are functions in the malware that are meant to be called by other programs or libraries</li>
      </ul>
      <h2 is-upgraded>Linked Libraries</h2>
      <ul>
        <li><b>Static linking</b> is the least commonly used method of linking libraries (it is common in UNIX and Linux programs). When a library is statically linked to an executable, all code from that library is copied into the executable, which makes the executable grow in size.</li>
        <li><b>Runtime linking</b> is commonly used in malware, especially when it’s <code>packed</code> or <code>obfuscated</code>. Executables that use runtime linking connect to libraries only when that function is needed.</li>
        <li><b>Dynamic linking</b> in which all the libraries are linked at program start.</li>
      </ul>
      <h2 is-upgraded>Obfuscated and Packed Malware</h2>
      <p>Malware writers often use packing or obfuscation to make their files more difficult to detect or analyze.</p>
      <ul>
        <li><b>Obfuscated</b> programs are ones whose execution the malware author has attempted to hide, not understandable.</li>
        <p><b>Example: Javascript obfuscation</b></p>
        <table>
        <tr>
          <td style="color:black;"><b>Javascript code</b><pre><code>
          function hi() {
            console.log("Hello World!");
            }
          hi();
          </pre></code></td>
          <td><b>Obfuscated Javascript code</b><pre><code>
            var _0x5ca5=['log','Hello\x20World!'];
            (function(_0xf4205a,_0x5ca5e0){var _0x28a099=function(_0x4c0ac1){
              while(--_0x4c0ac1){_0xf4205a['push'](_0xf4205a['shift']());}};
              _0x28a099(++_0x5ca5e0);}(_0x5ca5,0xa4));var _0x28a0=function(_0xf4205a,_0x5ca5e0){
                _0xf4205a=_0xf4205a-0x0;var _0x28a099=_0x5ca5[_0xf4205a];
                return _0x28a099;};
            function hi(){console[_0x28a0('0x0')](_0x28a0('0x1'));}hi();
          </pre></code></td>
        </tr>
       </table>
        <li><b>Packing</b> programs are a subset ofobfuscated programs in which the malicious program is compressed and cannot be analyzed </li>
        <aside class="special">Both techniques will severely limit your attempts to statically analyze the malware.</aside>
      </ul>
     </google-codelab-step>
     <google-codelab-step label="Environment Setup" duration="30">
       <p>Malware Analyst should be very careful while performing analysis, since malwares easily gets systems and networks infected we should setup a safe environment. In this workshop we are going to use Flare VM developed by <a href="https://www.fireeye.com/blog/threat-research/2017/07/flare-vm-the-windows-malware.html">Fireeye</a> cyber security experts.</p>
       <ul>
       <li>FLARE VM is a freely available and open sourced Windows-based security distribution designed for reverse engineers, malware analysts, incident responders, forensicators, and penetration testers. Inspired by open-source Linux-based security distributions like Kali Linux, REMnux and others</li>
       <li>FLARE VM delivers a fully configured platform with a comprehensive collection of Windows security tools such as debuggers, disassemblers, decompilers, static and dynamic analysis utilities, network analysis and manipulation, web assessment, exploitation, vulnerability assessment applications, and many others.</li>
       <li>The distribution also includes the FLARE team’s public malware analysis tools such as FLOSS and FakeNet-NG.</li>
       </ul>
      <aside class="special">In this section you will be setting up a safe virtual malware analysis environment. The virtual machine (VM) that you will be running the malware on should not have internet access nor network share access to the host system.</aside>
      <h2 is-upgraded>Installing VirtualBox</h2>
      <p>Click the icons below to download the version of Virtualbox for your OS.</p>
      <table>
      <tr><td colspan="1" rowspan="1"><p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank"><paper-button class="colored" raised>Windows VirtualBox</paper-button></a></p>
      </td><td colspan="1" rowspan="1"><p><a href="https://www.virtualbox.org/wiki/Linux_Downloads" target="_blank"><paper-button class="colored" raised>Linux VirtualBox</paper-button></a></p>
      </td><td colspan="1" rowspan="1"><p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank"><paper-button class="colored" raised>MacOS VirtualBox</paper-button></a></p>
      </td></tr>
      </table>
      <h2 is-upgraded>Download VM Directly</h2>
      <p><center><a href="" target="_blank"><paper-button class="colored" raised>MARE VM ZIP</paper-button></a></center></p>
      <p><center><code>OR</code></center></p>
      <h2 is-upgraded>Manual Setup instructions</h2>
      <h3>Install Windows 7 in Virtual Box</h3>
      <pre><code>Do not forget to install "Virtual Box Guest Additions" and Take 1st snapshot</code></pre>
      <aside class="special">Goto <code>Machine</code> tab and then select <code>Take Snapshot</code> to take a snapshot of current windows state</aside>
      <h3>Installing Flare VM Tools</h3>
      <table>
      <tr><td colspan="1" rowspan="1"><p><a href="https://www.fireeye.com/blog/threat-research/2018/11/flare-vm-update.html" target="_blank"><paper-button class="colored" raised>Fireeye Setup</paper-button></a></p>
      </td><td colspan="1" rowspan="1"><p><a href="https://github.com/fireeye/flare-vm" target="_blank"><paper-button class="colored" raised>Fireeye Github Repo</paper-button></a></p>
      </td></tr>
      </table>
      <pre><code>After installation of Flare VM tools take 2nd snapshot</pre></code>
    </google-codelab-step>
    <google-codelab-step label="Basic Static Analysis" duration="40">

    </google-codelab-step>
    <google-codelab-step label="Basic Dynamic Analysis" duration="40">

    </google-codelab-step>
  </google-codelab>
  <script src="../pkg/native-shim.js"></script>
  <script src="../pkg/custom-elements.min.js"></script>
  <script src="../pkg/prettify.js"></script>
  <script src="../pkg/codelab-elements.js"></script>


</body>
</html>
