<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="../pkg/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
	mark {
	  background-color: #52BE80;
	}
  </style>
  <script src="../gif/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../gif/gif-player.es5.js" defer async></script>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="re101"
                  title="Android Application Penetration Testing"
                  environment="web"
                  feedback-link="">


      <google-codelab-step label="Intro" duration="3">
			<h2 is-upgraded>Android</h2>
			<p>Android is a mobile operating system based on a modified version of the Linux kernel and other open source software, designed primarily for touchscreen mobile devices such as smartphones and tablets. Android is developed by a consortium of developers known as the Open Handset Alliance, with the main contributor and commercial marketer being Google.</p>
			<h2 is-upgraded>Android Application Penetration Testing</h2>
			<p>It is the process of testing and finding security issues in an android applications. Android security testing is more often used by security researchers to test the vulnerabilities in Android applications.</p>
			<h2 is-upgraded>What you&#39;ll learn</h2>
			<ul>
			<li>How to retrive an APK file</li>
			<li>How to decompile and reverse engineer the APK</li>
			<li>How to build and sign the APK</li>
			<li>How to find security vulnerabilities in the APK</li>
			</ul>
      </google-codelab-step>
	  <google-codelab-step label="Android Architecture" duration="15">
	  <h2 is-upgraded>Android Architecture</h2>
	  <p class="image-container"><img src="../aapt/and_arch.jpg" alt="android architecture"></p>
	  <ul>
	  <li><b>Applications:</b> Android Applications comprise both the native applications provided with the particular Android implementation (for example web browser and email applications) and the third-party applications installed by the user after purchasing the device. Typical applications include Camera, Alarm, Clock, Calculator, Contacts, Calendar, Media Player, and so forth.</li>
	  <li><b>Application Framework:</b> The Application Framework layer provides many higher-level services to applications in the form of Java classes. Application developers are allowed to make use of these services in their applications.</li>
	  <li><b>Libraries:</b> The libraries shown in the image are very necessary without which application will not run like Webkit library is used for browsing the web , SQLite library is used for maintaining SQL database and so on.</li>
	  <aside class="special"><h2 is-upgraded>Some useful libraries:</h2>
	  <ul>
	  <li><u>Surface Manager:</u> This manages the windows and screens </li>
	  <li><u>Media Framework:</u> This allows the use of various types of codecs for playback and recording of different media</li>
	  <li><u>SQLite:</u> This is a lighter version of SQL used for database management</li>
      <li><u>WebKit:</u> This is the browser rendering engine</li>
	  <li><u>OpenGL:</u> This is used to render 2D and 3D contents on the screen properly the libraries in Android are written in C and C++</li>
	  </ul>
	  </aside>
	  <li><b>Dalvik Virtual Machine: </b> DVM is specifically designed by Android Open Source Project to execute application written for Android.Each app running in the Android Device has its own Dalvik Virtual Machine</li>
	  <li><b>Android Run Time: </b> It is a alternative to Dalvik Virtual Machine which has been released with Android 4.4 as an experimental release,in Android Lollipop(5.0) it will completely replace Dalvik Virtual Machine.Major change in ART is because of Ahead-of-time(AOT) Compilation and Garbage Collection. In Ahead-of-time(AOT) Compilation ,android apps will be compiled when user installs them on their device whereas in the Dalvik used Just-in-time(JIT) compilation in which bytecode are compiled when user runs the app. Moving to the last one ,these are common.</li>
	  <li><b>Hardware Abstraction Layer:</b> Hardware Abstraction Layer just gives Applications direct access to the Hardware resources</li>
	  <li><b>Linux Kernel:</b> Android is built up on the Linux Kernel. Linux is already being used extensively from so many years and it’s kernel had received so many security patches. Linux Kernel provides basic system functionality like process management, memory management, device management like camera, keypad, display etc. Also, the kernel handles all the things that Linux is really good at such as networking and a vast array of device drivers, which take the pain out of interfacing to peripheral hardware.</li>
	  </ul>
	  </google-codelab-step>
	   <google-codelab-step label="Android Application" duration="10">
	   <p>Android apps are written in the Java programming language.</p>
       <p>The Android SDK tools compile your code—along with any data and resource files—into an APK.</p>
	   <p>APK or Android package is an archive file with an .apk suffix. One APK file contains all the contents of an Android app and is the file that Android-powered devices use to install the app</p>
	   <p class="image-container"><img src="../aapt/and_apps.png" alt="android apps"></p>
	   <p><b>An APK file is an Archive (ZIP File) that usually contains the following directories:</b></p>
	   <aside class="special">
		<p><b><u>AndroidManifest.xml:</u></b> The AndroidManifest.xml file is the control file that tells the system what to do with all the top-level components (specifically activities, services, broadcast receivers, and content providers) in an application.<br> This also specifies which permissions are required.</p>
		<p><center><mark>AndroidManifest.xml</b> is very important part of an APK file especially when security is concerned.</mark></center></p>
		<p><b><u>META-INF directory:</u></b></p>
		<ul>
	    <li><b><u>MANIFEST.MF:</u></b> The Manifest File</li>
		<li><b><u>CERT.RSA:</u></b> The certificate of the application.</li>
		<li><b><u>CERT.SF:</u></b> The list of resources and SHA-1 digest of the corresponding lines in the MANIFEST.MF file.</li>
		</ul>
		<p><b><u>lib:</u></b> The directory containing the compiled code that is specific to a software layer of a processor, the directory is split into more directories within it:</p>
		<ul>
		<li><b><u>armeabi:</u></b> Compiled code for all ARM based processors only</li>
		<li><b><u>armeabi-v7a:</u></b> Compiled code for all ARMv7 and above based processors only</li>
		<li><b><u>x86:</u></b> Compiled code for X86</li>
		<li><b><u>mips:</u></b> Compiled code for MIPS processors only</li>
		</ul>
		<p><b><u>res:</u></b> The directory containing resources not compiled into resources.arsc (see below).</b></p>
		<p><b><u>assets:</u></b> A directory containing applications assets, which can be retrieved by AssetManager.</b></p>
		<p><b><u>classes.dex:</u></b> The classes compiled in the dex file format understandable by the Dalvik virtual machine</b></p>
		<p><b><u>resources.arsc:</u></b> A file containing precompiled resources, such as binary XML for example.</b></p>
	   </aside>
	   </google-codelab-step>
	   <google-codelab-step label="Android Security" duration="15">
	   <h2 is-upgraded>Application Security Features by Android</h2>
	   <p><b><u>Android Permission Model</u></b></p>
	   <p>By default there are some Protected API’s in the Android Opertating System which can only be accessed by Operating System. The Protected APIs include</p>
		<ul>
		<li>Camera functions</li>
		<li>Location data (GPS)</li>
		<li>Bluetooth functions</li>
		<li>Telephony functions</li>
		<li>SMS/MMS functions</li>
		<li>Network/data connections</li>
		</ul>
		<aside class="special">If a particular application needs access to any of the API then it need to mention that permission in AndroidManifest.xml file. You might have observed that when installing a particular application from Google Play Store it ask for several permissions needed, if you don’t allow then app won’t install. If that user agrees to grant those permissions then Android operating system gives access to that Protected API.</aside>
	    <p><b><u>Application Signing</u></b></p>
		<ul>
		<li>Android requires that all apps be digitally signed with a certificate before they can be installed. Android uses this certificate to identify the author of an app.</li>
		<li>To run application on the device ,it should be signed.When application is installed on to an device then package manager verifies that whether the application has been properly signed with the certificate in the apk file or not.</li>
		<li>Application can be self signed or can be signed through CA.</li>
		<li>Application signing ensures that one application can’t access any other application except through well-defined IPC and also that it is passed unmodified to the device.</li>
		</ul>
		<p><b><u>Application Verification</u></b></p>
		<ul>
		<li>Android 4.2 and later support application verification. Users can choose to enable “Verify Apps” and have applications evaluated by an application verifier prior to installation.</li>
		<li>App verification can alert the user if they try to install an app that might be harmful; if an application is especially bad, it can block installation.</li>
		</ul>
		<p><b><u>Android Sandbox</u></b></p>
		<p>Once installed on a device, each Android app lives in its own security sandbox: – The Android operating system is a multi-user Linux system in which each app is a different user.</p>
		<ul>
		<li>By default, The android system assigns each app a unique Linux user ID (the ID is used only by the system and is unknown to the app). The system sets permissions for all the files in an app so that only the user ID assigned to that app can access them.</li>
		<li>Each process has its own virtual machine (VM), so an app’s code runs in isolation from other apps.</li>
        <li>Every app runs in its own Linux process. Android starts the process when any of the app’s components need to be executed, then shuts down the process when it’s no longer needed or when the system must recover memory for other apps.</li>
		</ul>
	   </google-codelab-step>
	   <google-codelab-step label="Penetration Testing Setup" duration="20">
	   <h2 is-upgraded>Required Softwares</h2>
	   <ul>
	   <li><b><a href="https://sourceforge.net/projects/appiefiles/files/" target="_blank">Appie</a> (Android Pen testing Portable Integrated Environment)</b> Appie is a software package that has been pre-configured to function as an Android Pentesting Environment on any windows based machine without the need of a Virtual Machine(VM). It contains all the tools required for performing penetration testing example: Apktool, ADB, sqlite browser, dex2jar, jd-gui etc.</li>
	   <aside class="special">The default installation directory for Appie is <pre><code><em>C:\Appie\</em></code></pre> Some Anti Virus may detect outdated softwares as viruses in the Appie installation directory, so whitelist this directory in Anti virus scanners. </aside>
	   <li><b><a href="https://www.genymotion.com/download/" target="_blank">Genymotion</a> (Android Emulator)</b> An Android emulator is an Android Virtual Device (AVD) that represents a specific Android device. You can use an Android emulator as a target platform to test Android applications on PC</li>
	   <aside class="special">
	   <ul>
	   <li>Step 1: Create an account in genymotion website to download. </li>
	   <p class="image-container"><img src="../aapt/create_gm_acc.png" alt="Create Genymotion Account"></p>
	   <li>Step 2: After downloading install it on your computer. </li>
	   <p class="image-container"><img src="../aapt/genymotion_install.png" alt="Install Genymotion"></p>
	   <li>Step 3: Open genymotion application and login with your genymotion credentials. </li>
	   <p class="image-container"><img src="../aapt/genymotion_login.png" alt="Genymotion Login"></p>
	   <li>Step 4: Accept genymotion <em><b>E.U.L.A.</b></em> licence</em> </li>
	   <p class="image-container"><img src="../aapt/genymotion_eula.png" alt="Genymotion End User License Agreement"></p>
	   <li>Step 5: Choose for <em><b>personal use</b></em> license</li>
	   <p class="image-container"><img src="../aapt/genymotion_personal_use.png" alt="Personal Use License"></p>
	   <li>Step 6: Now select any Android Virtual Device and Install (Example: Google Nessus 4	4.2 - API 17)</li>
	   <p class="image-container"><img src="../aapt/install_avd.png" alt="Install Android VM"></p>
	   <li>Step 7: Since we are using Appie, change the adb path settings in genymotion to Appie</li>
	   <p class="image-container"><img src="../aapt/adb_path.png" alt="Appie adb tools"></p>
	   <li id="step8">Step 8: Now right click on the installed android and start the emulator</li>
	   <p class="image-container"><img src="../aapt/avd.png" alt="AVD"></p>
	   </ul>
	   </aside>
	    <li><b><a href="#">Vulnerable Apps</a></b> In order to learn hacking legally, we will use two vulnerable apps developed by OWASP (FourGoats and HerdFinancial) which are available in the location <pre><code><em>C:\Appie\vulnerable_apps\OWASP-GoatDroid-0.9\goatdroid_apps\
		</pre></code></em></li>
	   </ul>
	   </google-codelab-step>
	   <google-codelab-step label="ADB" duration="20">
	   <h2 is-upgraded>Android Debugging Bridge</h2>
	   <p>ADB is a versatile command-line tool that lets you communicate with a device. The adb command facilitates a variety of device actions, such as installing and debugging apps, and it provides access to a Unix shell that you can use to run a variety of commands on a device. It is a client-server program that includes three components:</p>
	   <ul>
	   <li><b>A client</b>, which sends commands. The client runs on your development machine. You can invoke a client from a command-line terminal by issuing an adb command.</li>
	   <li><b>A daemon</b>, which runs commands on a device. The daemon runs as a background process on each device.</li>
	   <li><b>A server</b>, which manages communication between the client and the daemon. The server runs as a background process on your development machine.</li>
	   </ul>
	    <aside class="special">
		<p><b>ADB Commands:</b></p>
		<ul>
		<li>
		<p><pre><code>adb devices</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Prints a list of all attached emulator/device instances.</p></li>
		<li>
		<p><pre><code>adb install "OWASP GoatDroid- FourGoats Android App.apk"</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Installs an apk file in to connected emulator.</p></li>
		<li><p><pre><code>adb pull</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Command used to pull data from an android emulator to pc.</p></li>
		<li>
		<p><pre><code>adb push</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Command used to push data from the pc to android emulator.</p></li>
		<li>
		<p><pre><code>adb shell</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Provides a UNIX Shell that can use to run a variety of commands on an emulator.</p></li>
		<li>
		<p><pre><code>adb uninstall org.owasp.goatdroid.fourgoats</pre></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Uninstalls the apk from emulator.</p></li>
		</ul>
		<h2 is-upgraded><u>Practise:</u></h2>
		<ul>
		<p><em><mark><b>Before going to practise these commands:</b></mark></em></p>
		<li>Copy the OWASP GoatDroid - FourGoats Android App.apk from</li>
		<em><b><pre><code>"C:\Appie\vulnerable_apps\OWASP-GoatDroid-0.9\goatdroid_apps\   -->   C:\Users\mrpvr\Desktop"</pre></code></b></em>
		<li>And start android virtual device that we have installed in genymotion <a href="#step8">step 8</a></li>
		</ul>
		</p>
		<p class="image-container"><img src="../aapt/adb_commands.png" alt="adb commands"></p>
		</aside>
		</google-codelab-step>
		<google-codelab-step label="OWASP" duration="15">
		<h2 is-upgraded>Open Web Application Security Project</h2>
		<p>It is a community of developers that creates methodologies, documentation, tools, and technologies in the field of web and mobile application security. Its Top 10 lists of risks are constantly updated resources aimed at creating awareness about emerging security threats to web and mobile applications in the developer community. You can check the complete list of projects by OWASP <b><a href="https://owasp.org/projects/">here</a></b></p>
	        <p>OWASP Mobile Top 10 is a list that identifies types of security risks faced by mobile apps globally. This list, which was last updated in 2016, is an acting guide for developers to build secure applications and incorporate best coding practices.</p>
	  <aside class="special">
		<h2 is-upgraded>OWASP Top 10 Intro</h2>
		<ul>
		<li><b>M1 Improper Platform</b> Misuse of a platform feature or failure to use platform security controls.</li>
		<li><b>M2 Insecure Data Storage</b> Covers insecure data storage and unintended data leakage in mobile storage</li>
		<li><b>M3 Insecure Communication</b> Communication that are not encrypted and not correctly authenticated.</li>
		<li><b>M4 Insecure Authentication</b> Problems authenticating the end user or bad session management.</li>
		<li><b>M5 Insufficient Cryptography</b> Cryptography was attempted, but insufficient not good enough.</li>
		<li><b>M6 Insecure Authorization</b> </li>
		<li><b>M7 Poor Code Quality</b> Application code-level implementation problems in the mobile client.</li>
		<li><b>M8 Code Tampering</b> Tampering the source code of the application.</li>
		<li><b>M9 Reverse Engineering</b> Might include analysis of the final core binary to determine its source code, libraries, algorithms and other assets.</li>
		<li><b>M10 Extraneous Functionality</b> Hidden backdoor functionality in tha application.</li>
		</ul>

		</google-codelab-step>
 </google-codelab>

  <script src="../pkg/native-shim.js"></script>
  <script src="../pkg/custom-elements.min.js"></script>
  <script src="../pkg/prettify.js"></script>
  <script src="../pkg/codelab-elements.js"></script>


</body>
</html>
